<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="icon" type="image/x-icon" href="/public/img/favicon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicon-16x16.png">
  <link rel="manifest" href="/assets/img/site.webmanifest">
  <link rel="mask-icon" href="/assets/img/safari-pinned-tab.svg" color="#5bbad5">
  <link rel="shortcut icon" href="/assets/img/favicon.ico">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-config" content="/assets/img/browserconfig.xml">
  <meta name="theme-color" content="#ffffff">

  <link rel="stylesheet" href="/public/css/bootstrap.min.css" />

  <link rel="stylesheet" href="/public/css/lnr-icon.css" />

  <link rel="stylesheet" href="/public/css/font-awesome.min.css" />

  <link rel="stylesheet" href="/public/plugins/select2/select2.min.css" />

  <link rel="stylesheet" href="/public/css/style.css" />
  <title>LEAVE</title>

</head>

<body>
  <div class="inner-wrapper">
    <!--  header partials  -->
    <%- include('partials/headerEmployee'); %>

      <div class="page-wrapper">
        <div class="container-fluid">
          <div class="row">
            <!--  side bar aside tag -->
            <%- include('partials/asideEmployee'); %>

              <div class="col-xl-10 col-lg-9 col-md-12">

                <div class="card shadow-sm grow ctm-border-radius">
                  <div class="card-body align-center">
                    <h4 class="card-title float-left mb-0 mt-2">Leave Details</h4><br></br>

                    <ul class="nav nav-tabs float-right border-0 tab-list-emp">

                    </ul>
                  </div>
                </div>
                <div class="card shadow-sm grow ctm-border-radius">
                  <div class="card-body d-flex justify-content-between">
                    <a class="btn btn-theme button-1 text-white ctm-border-radius add-person ctm-btn-padding"
                      onclick="viewLeaveFun()">
                      <i class="fa fa-angles-left"></i>&nbsp;View Leaves
                    </a>
                    <a class="btn btn-theme button-1 text-white ctm-border-radius add-person ctm-btn-padding"
                      onclick="history.back()">
                      Back&nbsp;<i class="fa fa-angles-right"></i>
                    </a>
                  </div>
                </div>

                <% function formatDate(dateObject) { let d=new Date(dateObject); let day=d.getDate(); let
                  month=d.getMonth() + 1; let year=d.getFullYear(); if (day < 10) { day="0" + day; } if (month < 10) {
                  month="0" + month; } let date=year + "-" + month + "-" + day; return date; }; %>
                  <div class="ctm-border-radius shadow-sm grow card">
                    <div class="card-body">
                      <% leavesdata.forEach(leavedata=> { %>
                        <form id="formleave" action="/leave/update/<%= leavedata.id %>" method="post">

                          <div class="mb-3">
                            <label class="form-label text-orange lead">Start Date :</label>
                            <input type="date" class="form-control" name="startDate" id="startDate"
                              value="<%= formatDate(leavedata.startDate) %>">
                          </div>
                          <div class="mb-3">
                            <label class="form-label text-orange lead">End Date :</label>
                            <input type="date" class="form-control" name="endDate" id="endDate"
                              value="<%= formatDate(leavedata.endDate) %>">
                          </div>
                          <div class="mb-3">
                            <label class="form-label text-orange lead">Reason :</label>
                            <input type="text" class="form-control" name="reason" id="reason"
                              value="<%= leavedata.reason %>">
                          </div>
                          <% if(leavedata.status==='pending' ){ %>
                            <div class="mb-3">
                              <label class="form-label text-orange lead">isArchive :</label>
                              <label class="switch">
                                <input type="checkbox" id="isArchived" name="isArchived">
                                <span class="slider"></span>
                              </label>
                            </div>
                            <% } %>
                              <div class="d-flex justify-content-between">
                                <% if(leavedata.status==='pending' ){ %>
                                  <button type="submit"
                                    class="btn btn-theme button-1 text-white ctm-border-radius p-2 add-person ctm-btn-padding px-3"
                                    id="updateleave">
                                    <h4>Edit Leave</h4>
                                  </button>
                                  <% } %>

                              </div>
                        </form>
                        <% }) %>


                    </div>
                  </div>
              </div>
          </div>
        </div>
      </div>
  </div>
  </div>
  <div class="sidebar-overlay" id="sidebar_overlay"></div>

  <script src="/public/js/jquery-3.2.1.min.js"></script>

  <script src="/public/js/popper.min.js"></script>
  <script src="/public/js/bootstrap.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.3/dist/additional-methods.min.js"></script>

  <script src="/public/plugins/theia-sticky-sidebar/ResizeSensor.js"></script>
  <script src="/public/plugins/theia-sticky-sidebar/theia-sticky-sidebar.js"></script>

  <script src="/public/plugins/select2/moment.min.js"></script>
  <script src="/public/js/bootstrap-datetimepicker.min.js"></script>

  <script src="/public/plugins/select2/select2.min.js"></script>

  <script src="/public/plugins/bootstrap-tagsinput/bootstrap-tagsinput.min.js"></script>

  <script src="/public/js/script.js"></script>
  <script src="/public/js/navigation.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js"
    integrity="sha512-37T7leoNS06R80c8Ulq7cdCDU5MNQBwlYoy1TX/WUsLFC2eYNqtKlV0QjH7r8JpG/S0GUMZwebnVFLPd6SU5yg=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.0/jquery.validate.js"></script>

  <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>

  <script src="https://cdn.jsdelivr.net/jquery.validation/1.16.0/jquery.validate.min.js"></script>

  <script src="https://cdn.jsdelivr.net/jquery.validation/1.16.0/additional-methods.min.js"></script>

  <script>
    $('.aside-module-name').text('Leaves');
    $('#asideLeave').removeClass('text-dark').addClass('active').addClass('text-white');

  </script>

  <script>
    function formatDate(dateObject) {
      let d = new Date(dateObject); let day = d.getDate();
      let month = d.getMonth() + 1; let year = d.getFullYear(); if (day < 10) {
        day = "0" + day;
      } if (month < 10) { month = "0" + month; } let date = year + "-" + month + "-" + day;
      return date;
    };


    $(function () {
      jQuery.validator.setDefaults({
        debug: true,
        success: "valid"
      });


      $.validator.addMethod('dateBefore', function (value) {


        var curr = new Date();
        const format = formatDate(curr);
        return value > format;

      }, 'Must be after corresponding current date');

      $.validator.addMethod('dateAfter', function (value, element, params) {
        var start = $(params);
        if (!start.data('validation.running')) {
          $(element).data('validation.running', true);
          setTimeout($.proxy(

            function () {
              this.element(start);
            }, this), 0);
          setTimeout(function () {
            $(element).data('validation.running', false);
          }, 0);
        }
        return this.optional(element) || this.optional(start[0]) || new Date(value) >= new Date($(params).val());

      }, 'Must be after corresponding start date');
      $("#formleave").validate({
        rules: {
          startDate: {
            dateBefore: '#startDate',
            required: true,
          },
          endDate: {
            dateAfter: '#startDate',
            required: true
          },
          reason: {
            required: true
          }
        },
        messages: {
          startDate: {
            required: "specify start date of your leave"
          },
          endDate: {
            required: "specify end date of your leave"
          },
          reason: {
            required: "specify reason of your leave "
          }
        },
        submitHandler: function (form) {
          form.submit();
        }
      });


    });
    function viewLeaveFun() {
      $.ajax({
        url: '/leave/view',
        method: 'get'
      })
      window.location.href = `/leave/view`;
    }
  </script>




</body>

</html>